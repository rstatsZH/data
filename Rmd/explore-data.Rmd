---
title: "Untitled"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

# Daten - Kursteilnehmer_innen

Kursteilnehmer_innen werden als Vorbereitung auf den Kurs darum gebeten opendata.swiss zu öffnen und einen Datensatz im CSV Format zu identifizieren welcher sie interessiert. Die Datensätze werden auf Slack geteilt mit einer kurzen Begründung warum der Datensatz interessiert und warum dieser ausgewählt wurde.

## rstatsZH-K001

## Steuerbares Einkommen natürliche Pers. [Mio.Fr.] 

### Meine Notizen

Ein interessanter Datensatz, welcher es erlaubt einige Konzepte eizuführen:

- read_delim()
- filter(max())
- arrange()
- joins

**TODO**

- Geodaten für Kanton Zürich
- Gemeinden, Population, etc.
- 

```{r}

steuer_nat <- read_delim("https://www.web.statistik.zh.ch/ogd/data/KANTON_ZUERICH_283.csv", delim = ";")

steuer_nat %>% 
  filter(INDIKATOR_JAHR == max(INDIKATOR_JAHR)) %>% 
  arrange(desc(INDIKATOR_VALUE)) %>% 
  filter(BFS_NR != 0) 

ggplot(data = steuer_nat, mapping = aes(x = ))

```

## Übersicht über alle Lernenden im Kanton Zürich

### Daten importieren

1. Code ausführen. Was ist mit der Warnung? Was könnte diese bedeuten?
2. Ladet die CSV lokal auf euer Arbeitsgerät und öffnet diese mit MS Excel
3. Schaut in Zeile 1961 in Spalte A. Was steht dort`? 
4. Beschreibe was mit der Zeile `locale = locale(encoding = "ISO-8859-1")` erreicht wird

```{r}

lernende <- read_csv("https://www.web.statistik.zh.ch/ogd/data/bista/ZH_Uebersicht_alle_Lernende.csv", 
                     locale = locale(encoding = "ISO-8859-1"))

lernende_2019 <- lernende %>% 
  filter(Jahr == 2019) %>% 
  drop_na() 

```


```{r}

lernende %>% 
  glimpse()

```

```{r}

lernende %>% 
  filter(Jahr == 2019) %>% 

ggplot(aes(x = Schultyp, y = Anzahl, fill = Nationalitaet)) +
  geom_col() +
  coord_flip() 


ggplot(lernende_2019, aes(x = Stufe, y = Anzahl, fill = Nationalitaet)) +
  geom_col() +
  coord_flip()

lernende %>%
  filter(Jahr == 2019) %>% 
  filter(Schultyp %in% c("Mittelschule", "Volksschule")) %>% 
  count(Schultyp)
  group_by(Stufe) %>% 
  count()

  
lernende_2019 %>% 
  count(Stufe, Schultyp, wt = Anzahl)

glimpse(lernende)

lernende %>% 
  count(Schultyp)
  gglot(aes(x = Stufe, y = Anzahl)) 

```


## rstatsZH-K002

# Daten - Übungen 

Im Kurs finden immer wieder Übungen mit Daten statt, welche wenig bis keine Manipulationen benötigen um visualisiert zu werden. Diese Datensätze werden hier gesammelt.

## Corona Hilfen im Kulturbereich im Kanton Zürich

### Daten importieren

```{r}
# Daten importieren

corona_kultur <- read_csv("https://www.web.statistik.zh.ch/ogd/data/ji/fk/kultur_ausfallentschaedigung.csv")

```

### Daten erkunden

In der Sparte "Musik" wurden die grössten Beträge für Corona Hilfen im Kulturbereich beantragt und bewilligt. Bei gemeinnützigen Kulturunternhmen und Kulturschaffenden macht dies den grössten Anteil aus.

Danke für die tollen Daten @OpenDataZH und Fachstelle Kultur @KantonZuerich!

```{r}

# Daten visualisieren - Anzahl Anträge nach Sparte und Kategorie

ggplot(data = corona_kultur, 
       mapping =  aes(x = Status, 
                      fill = Sparte)) +
  geom_bar() +
  facet_wrap(~Kategorie, nrow = 3) +
  theme_bw() +
  theme(legend.position = "bottom")

# Daten visualisieren - Beantragte und beschlossene Summe nach Sparte und Kategorie

## Daten Manipulation 

corona_kultur %>% 
  group_by(Kategorie, Sparte) %>% 
  summarise(
    beantragt = sum(Nachgefragt, na.rm = TRUE),
    beschlossen = sum(Beschluss, na.rm = TRUE)
  ) %>% 
  pivot_longer(cols = beantragt:beschlossen, names_to = "typ", values_to = "summe") %>% 
  
  ## Daten Visualisierung 
  
  ggplot(aes(x = reorder(Sparte, summe), y = summe, fill = typ)) +
  geom_col(position = position_dodge()) +
  facet_wrap(~Kategorie) +
  scale_fill_brewer(type = "qual", palette = "Dark2") +
  scale_y_continuous(labels = scales::label_number(scale = 1 / 1e6, prefix = "CHF ")) +
  labs(
    title = "Corona Hilfen im Kulturbereich im Kanton Zürich",
    subtitle = "Beantragte und beschlossene Summe nach Sparte und Kategorie",
    caption = "Datenquelle: Fachstelle OGD des Kantons Zürich",
    x = "",
    y = "Summe in Millionen"
  ) +
  coord_flip() +
  theme_bw(base_size = 16) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
    panel.grid.major.y = element_blank()
  ) 

```

## Covid19 Daten Schweiz

### Daten importieren


```{r}
covid19zh <- read_csv("https://raw.githubusercontent.com/openZH/covid_19/master/COVID19_Fallzahlen_CH_total_v2.csv")
```


### Daten manipulieren

```{r}
covid19zh_n_conf <- covid19zh %>% 
  select(date, abbreviation_canton_and_fl, ncumul_conf) %>% 
  arrange(abbreviation_canton_and_fl, date) %>% 
  group_by(abbreviation_canton_and_fl) %>% 
  mutate(n_conf = ncumul_conf - lag(ncumul_conf))
```

### Daten visualisieren

```{r}

ggplot(data = covid19zh_n_conf, mapping =  aes(x = date, y = n_conf, color = abbreviation_canton_and_fl)) +
  geom_line() +
  facet_wrap(~abbreviation_canton_and_fl) +
  geom_line() +
  scale_x_date(date_labels = "%B %d") # month and day

ggplot(data = covid19zh, 
       mapping = aes(x = date, 
                     y = ncumul_conf)) +
  geom_line() +
  scale_x_date(date_labels = "%W", date_breaks = "2 weeks") # month and day

```


```{r}
```

